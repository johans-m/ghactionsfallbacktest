name: Workflow con fallback

on:
  workflow_dispatch:

jobs:
  primer-job:
    runs-on: ubuntu-latest
    continue-on-error: true
    outputs:
      resultado: ${{ steps.set-output.outputs.status }}
    steps:
      - name: Ejecutar con control manual del tiempo
        id: test
        run: |
          echo "Iniciando tarea con tiempo controlado..."
          SECONDS=0

          # Simula una tarea larga (puedes cambiar sleep por otro comando real)
          sleep 30

          DURATION=$SECONDS
          echo "Duración: $DURATION segundos"

          # Si pasó el límite, fallamos manualmente
          if [ "$DURATION" -gt 10 ]; then
            echo "::warning title=Tarea lenta::La tarea tardó más de 60s"
            exit 1
          else
            echo "Tarea completada dentro del tiempo"
          fi
        continue-on-error: true

  segundo-job:
    runs-on: ubuntu-latest
    needs: primer-job
    if: needs.primer-job.outputs.resultado == 'FAIL'
    steps:
      - name: Mostrar mensaje de uso
        run: |
          echo "Se usó el segundo"
          echo "::notice title=Segundo job activado::El segundo job fue ejecutado porque el primero falló"
